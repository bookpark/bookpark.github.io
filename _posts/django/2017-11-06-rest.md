---
layout: post
comments: true
title: "Django REST Framework"
categories: REST
---

[RESTFul이란 무엇인가](http://blog.remotty.com/blog/2014/01/28/lets-study-rest/)

[RESTful API를 설계하기 위한 디자인 팁](https://spoqa.github.io/2013/06/11/more-restful-interface.html)

---

#### Serializer

- serializers.py

```python
class SnippetSerializer(serializers.ModelSerializer):
    
    class Meta:
        model = Snippet
        fields = (
            'id',
            'title',
            'code',
            'linenos',
            'language',
            'style',
        )
```



#### Mixins

- patch
  - partial_update() — 부분 업데이트
- create
  - perform_create() — serializer.save() 동작을 다르게 하기 위해서는 모델에서 재정의해준다.



#### Authentication

***Basic***

- perform_create() 재정의

```python
class SnippetList(generics.ListCreateAPIView):
    
	def perform_create(self, serializer):
        serializer.save(owner=self.request.user)
```

- Serializer 모델에서 source 정의

```python
class SnippetSerializer(serializers.ModelSerializer):
	owner = serializers.ReadOnlyField(source='owner.username')
```

- views.py

```python
from rest_framework import generics, permissions


class SnippetList(generics.ListCreateAPIView):
	permission_classes = (
        permissions.IsAuthenticatedOrReadOnly,
    )
```

- permissions.py

```python
from rest_framework import permissions


class IsOwnerOrReadOnly(permissions.BasePermission):
    def has_object_permission(self, request, view, obj):
        if request.method in permissions.SAFE_METHODS:
            return True

        return obj.owner == request.user

```

> 첫 permission은 BasePermission을 불러온 후 has_object_permission() 메서드를 재정의한다.

- views.py

```python
from .permissions import IsOwnerOrReadOnly


class SnippetDetail(generics.RetrieveUpdateDestroyAPIView):
    queryset = Snippet.objects.all()
    serializer_class = SnippetSerializer
    permission_classes = (
        permissions.IsAuthenticatedOrReadOnly,
        IsOwnerOrReadOnly,
    )
```

> IsOwnerOrReadyOnly permission을 Detail의 permission_classes에 추가해준다. (Retrieve/Update/Destroy)



***Token***

"""

"""

---

#### ViewSets

- ViewSet 클래스는 `list`, `create`, `retreive`, `update`, 그리고 `destroy`를 자동으로 제공한다.
- 추가적으로 `highlight` action도 제공한다.

```python
from rest_framework import viewsets, permissions

from .models import Snippet
from .permissions import IsOwnerOrReadOnly
from .serializers import SnippetSerializer


class SnippetViewSet(viewsets.ModelViewSet):
    queryset = Snippet.objects.all()
    serializer_class = SnippetSerializer
    permission_classes = (
        permissions.IsAuthenticatedOrReadOnly,
        IsOwnerOrReadOnly,
    )

    def perform_create(self, serializer):
        serializer.save(owner=self.request.user)
```



***url router***

- url router를 register한다면 url을 router에서 알아서 생성해준다.

```python
from django.conf.urls import url, include
from rest_framework.routers import DefaultRouter

from .views import SnippetViewSet

router = DefaultRouter()
router.register(r'', SnippetViewSet)

urlpatterns = [
    url(r'^', include(router.urls)),
]
```



#### Serializer method field

- model에 없는 정보를 메서드로 전해주고 싶을 때 SerializerMethodField()를 써주면 된다.

```python
from django.contrib.auth.models import User
from django.utils.timezone import now
from rest_framework import serializers

class UserSerializer(serializers.ModelSerializer):
    days_since_joined = serializers.SerializerMethodField()

    class Meta:
        model = User

    def get_days_since_joined(self, obj):
        return (now() - obj.date_joined).days

```

