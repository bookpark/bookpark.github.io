---
layout: post
title:  "TIL 1일차"
categories: TIL
---

# TIL 1일차

## Recursive Relationship (재귀 관계)

### 자기 자신과 `다대일 관계` (many-to-one relationship)을 갖을 때

상대가 없어지면 자기 자신도 없어짐

```python
# 만약 아직 정의되지 않은 ForeignKey를 정의하고 싶다면 참조하는 클래스를 문자열로 넣어준다 (문자열이기 때문에 rename 시킬 때는 같이 바뀌지 않는다
class Car(models.Model):
    # 제조사가 사라지면 차종도 사라진다
    manufacturer = models.ForeignKey('Manufacturer', on_delete=models.CASCADE)
    name = models.CharField(max_length=50, blank=True)
    
class Manufacturer(models.Model):
    name = models.CharField(max_length=50)
```

상대가 없어져도 자기 자신은 살아있음

```python
# 동등한 유저일 때 관계를 가지는 경우
class User(models.Model):
    name = models.CharField(max_length=30)
    # 배우자가 없어져도 자신은 없어지지 않는다 (on_delete=models.SET_NULL)
    spouse = models.ForeignKey('self', on_delete=models.SET_NULL, null=True, blank=True)
```

**The possible values for `on_delete` are found in django.db.models:**

* `CASCADE`  
Cascade deletes. Django emulates the behavior of the SQL constraint ON DELETE CASCADE and also deletes the object containing the ForeignKey.

* `PROTECT`  
Prevent deletion of the referenced object by raising ProtectedError, a subclass of django.db.IntegrityError.

* `SET_NULL`  
Set the ForeignKey null; this is only possible if null is True.

* `SET_DEFAULT`  
Set the ForeignKey to its default value; a default for the ForeignKey must be set.

* `SET()`  
Set the ForeignKey to the value passed to SET(), or if a callable is passed in, the result of calling it. In most cases, passing a callable will be necessary to avoid executing queries at the time your models.py is imported:



### Many-to-many Symmetrical

* 보통 many-to-many는 대칭관계를 갖는다 (내가 너의 친구라면 너도 나의 친구)
* `symmetrical=False` 값을 줬을 때는 대칭이 아닌 관계가 됨

```python
class InstagramUser(models.Model):
    name = models.CharField(max_length=30)
    following = models.ManyToManyField('self', symmetrical=False, blank=True)
```

### Intermediate Model

* 중계자 모델을 사용하여 관계를 갖는다
* `through`를 사용하여 중계자 모델을 선택한다

```python
class Idol(models.Model):
    name = models.CharField(max_length=30)

    def __str__(self):
        return self.name


class Group(models.Model):
    name = models.CharField(max_length=30)
    debut_date = models.DateField()
    members = models.ManyToManyField(Idol, through='Membership')

    def __str__(self):
        return self.name


class Membership(models.Model):
    idol = models.ForeignKey(Idol, on_delete=models.CASCADE)
    group = models.ForeignKey(Group, on_delete=models.CASCADE)
    joined_date = models.DateField()
    is_active = models.BooleanField()

    def __str__(self):
        return f'{self.group.name} ' \
               f'{self.idol.name} ' \
               f'({self.is_active})'
```


